!function(t){"use strict";var a=!1;t.ajaxloadmore=function(e){var o=this,n=0;o.AjaxLoadMore={},o.page=0,o.speed=300,o.proceed=!1,o.init=!0,o.loading=!0,o.finished=!1,o.window=t(window),o.button_label="",o.data,o.el=e,o.content=t(".alm-listing",o.el),o.scroll=!0,o.prefix="alm-",o.repeater=o.content.data("repeater"),o.max_pages=o.content.data("max-pages"),o.pause=o.content.data("pause"),o.offset=o.content.data("offset"),o.transition=o.content.data("transition"),o.lang=o.content.data("lang"),o.posts_per_page=o.content.data("posts-per-page"),t(window).scrollTop(0),void 0===o.pause&&(o.pause=!1),void 0===o.repeater&&(o.repeater="default"),void 0===o.max_pages&&(o.max_pages=5),"none"===o.max_pages&&(o.max_pages=1e6),o.transition=void 0===o.transition?"slide":"fade"===o.transition?"fade":"slide",o.offset=void 0===o.content.data("offset")?0:o.content.data("offset"),o.button_label=void 0===o.content.data("button-label")?"Older Posts":o.content.data("button-label"),o.scroll=void 0===o.content.data("scroll")?!0:o.content.data("scroll")===!1?!1:!0,o.post_type=o.content.data("post-type"),o.post_type=o.post_type.split(","),o.el.append('<div class="'+o.prefix+'btn-wrap"><button id="load-more" class="'+o.prefix+'load-more-btn more">'+o.button_label+"</button></div>"),o.button=t(".alm-load-more-btn",o.el),o.AjaxLoadMore.loadPosts=function(){o.button.addClass("loading"),o.loading=!0,t.ajax({type:"GET",url:alm_localize.ajaxurl,data:{action:"ajax_load_more_init",nonce:alm_localize.alm_nonce,repeater:o.repeater,postType:o.post_type,postFormat:o.content.data("post-format"),category:o.content.data("category"),author:o.content.data("author"),taxonomy:o.content.data("taxonomy"),taxonomy_terms:o.content.data("taxonomy-terms"),taxonomy_operator:o.content.data("taxonomy-operator"),meta_key:o.content.data("meta-key"),meta_value:o.content.data("meta-value"),meta_compare:o.content.data("meta-compare"),tag:o.content.data("tag"),order:o.content.data("order"),orderby:o.content.data("orderby"),search:o.content.data("search"),exclude:o.content.data("exclude"),numPosts:o.content.data("posts-per-page"),pageNumber:o.page,offset:o.offset,lang:o.lang},dataType:"html",beforeSend:function(){1!=o.page&&o.button.addClass("loading")},success:function(e){o.data=t(e),o.init&&(o.button.text(o.button_label),o.init=!1),o.data.length>0?(o.el=t('<div class="'+o.prefix+'reveal"/>'),o.el.append(o.data),o.el.hide(),o.content.append(o.el),"fade"===o.transition?o.el.fadeIn(o.speed,"alm_easeInOutQuad",function(){o.loading=!1,o.button.delay(o.speed).removeClass("loading"),o.data.length<o.posts_per_page&&(o.finished=!0,o.button.addClass("done"))}):o.el.slideDown(o.speed,"alm_easeInOutQuad",function(){o.loading=!1,o.button.delay(o.speed).removeClass("loading"),o.data.length<o.posts_per_page&&(o.finished=!0,o.button.addClass("done"))}),t.isFunction(t.fn.almComplete)&&t.fn.almComplete(o)):(o.button.delay(o.speed).removeClass("loading").addClass("done"),o.loading=!1,o.finished=!0),a||o.AjaxLoadMore.setSocials(),o.AjaxLoadMore.setGrid(),o.AjaxLoadMore.setCols(),twttr?twttr.widgets.load():setTimeout(function(){twttr.widgets.load(),console.log("hi")},3e3)},error:function(){o.loading=!1,o.button.removeClass("loading")}})},o.AjaxLoadMore.setSocials=function(){var e,o,n,s,l,i,d,r,c=t(".grid-justified"),p=[{name:"twitter",_class:"tw",url:"https://twitter.com/64_mag"},{name:"facebook",_class:"fb",url:"https://www.facebook.com/pages/F64/1443859355897584"},{name:"instagram",_class:"inst",url:"http://instagram.com/64mag"},{name:"tumblr",_class:"tum",url:"http://64mag.tumblr.com/"},{name:"soundcloud",_class:"sc",url:"https://soundcloud.com/64mag"},{name:"vk",_class:"vk",url:"http://vk.com/diaphragm64"}];e=c.find(".article-item"),o=Math.floor(Math.random()*e.length),i=Math.floor(Math.random()*e.length),n=Math.floor(Math.random()*p.length),s=p[n],l="<article class='article-item article-social'><a href='"+s.url+"' class='"+s._class+"' target='_blank'>Follow 64MAG on "+s.name+"</a></article>",d=t("<div></div>").addClass("article-item").addClass("twitter-widget").css({height:"420px",width:"322px"}),d.attr("id","twitter-timeline"),r=t('<a href="https://twitter.com/64_mag"></a>').text("Tweets by @64_mag").addClass("twitter-timeline").attr("data-widget-id","561853647081185281"),d.append(r),d.insertBefore(e.eq(o)),t(l).insertBefore(e.eq(i)),a=!0},o.AjaxLoadMore.setGrid=function(){function a(){l=[],d.each(function(t){l[t]=d.eq(t).height()})}function e(){var t=[];d.each(function(a){d.eq(a).addClass("absolute"),d.eq(a).css({left:o(a)+"px"}),d.eq(a).css(3>a?{top:"0px"}:{top:n(a)+"px"}),a>=d.length-3&&t.push(d.eq(a).height()+d.eq(a).position().top)});var a=Math.max.apply(null,t);s(a)}function o(t){var a=t%3,e=(r+c)*a;return e}function n(t){var a=t,e=0;for(a;a>=0;a-=3)a!=t&&(e+=l[a]+c);return e}function s(t){i.height(Math.round(t))}var l,i=t(".grid-justified"),d=i.find(".article-item"),r=322,c=20;a(),e()},o.AjaxLoadMore.setCols=function(){function a(a,o){var s=e.eq(a).find("article");s.each(function(a){var e=a-n,s=e+1;console.log(),s>=0&&(s==o||s%o==0)&&t(this).addClass("last")}),n+=s.length}var e=t(".grid");e.each(function(t){var o=e.eq(t).attr("class"),n=e.eq(t).attr("class").indexOf("col-"),s=-1;if(n>=0){if(s=parseInt(o.substr(n+4,n+5)),1==s)return;a(t,s)}})},o.button.on("click",function(){o.pause===!0&&(o.pause=!1,o.AjaxLoadMore.loadPosts()),o.loading||o.finished||t(this).hasClass("done")||(o.loading=!0,o.page++,o.AjaxLoadMore.loadPosts())}),o.AjaxLoadMore.isVisible=function(){return o.visible=!1,o.el.is(":visible")&&(o.visible=!0),o.visible},o.scroll&&o.window.bind("scroll touchstart",function(){if(o.AjaxLoadMore.isVisible()){var t=o.button.offset();!o.loading&&!o.finished&&o.window.scrollTop()>=Math.round(t.top-(o.window.height()-150))&&o.page<o.max_pages-1&&o.proceed&&!o.pause&&(o.loading=!0,o.page++,o.AjaxLoadMore.loadPosts())}}),o.pause===!0?(o.button.text(o.button_label),o.loading=!1):o.AjaxLoadMore.loadPosts(),setTimeout(function(){o.proceed=!0},1e3),t.easing.alm_easeInOutQuad=function(t,a,e,o,n){return(a/=n/2)<1?o/2*a*a+e:-o/2*(--a*(a-2)-1)+e}},t.fn.ajaxloadmore=function(){return this.each(function(){t(this).data("alm",new t.ajaxloadmore(t(this)))})},t(".ajax-load-more-wrap").length&&t(".ajax-load-more-wrap").ajaxloadmore()}(jQuery);